name: Build Carnac (with Mouse Support)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.1

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v1.2.0

    - name: Restore NuGet packages
      run: nuget restore src/Carnac.sln

    - name: Build Carnac.csproj (Release)
      run: msbuild src/Carnac/Carnac.csproj /m /p:Configuration=Release /p:TargetFrameworkVersion=v4.8 /p:TargetFrameworkProfile=

    - name: Collect Artifacts
      run: |
        mkdir output
        copy src\Carnac\bin\Release\Carnac.exe output\
        copy src\Carnac\bin\Release\Carnac.exe.config output\
        copy src\Carnac\bin\Release\Carnac.pdb output\
        xcopy src\Carnac.Logic\bin\Release\Keymaps output\Keymaps /E /I /Y
      shell: cmd

    - name: Upload Artifact
      uses: actions/upload-artifact@v3
      with:
        name: Carnac-Release
        path: output
